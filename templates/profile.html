{% extends "base.html" %}

{% block title %}Profile{% endblock %}

{% block content %}
<div class="dashboard">
    <!-- TOP HEADER - EXACTLY LIKE CART PAGE (FONT STYLE.CSS SE) -->
    <header class="dashboard-header">
        <div class="header-left">
            <h1>Profile</h1>
            <p class="welcome-text">Manage your account</p>
        </div>
        <div class="header-right">
            <img src="{{ session.profile_pic }}" 
                 alt="Profile" class="profile-pic"
                 onerror="this.src='{{ url_for('static', filename='default-avatar.jpg') }}'">
        </div>
    </header>

    <!-- MAIN CONTENT - INSTAGRAM STYLE 2-COLUMN -->
    <main class="main-content">
        <!-- PROFILE HEADER - 2-COLUMN LAYOUT -->
        <div class="profile-header-instagram">
            <!-- LEFT COLUMN: PHOTO -->
            <div class="profile-photo-col">
                <div class="profile-avatar-instagram">
                    <img src="{{ session.profile_pic }}" 
                         alt="Profile" class="profile-img-instagram"
                         onerror="this.src='{{ url_for('static', filename='default-avatar.jpg') }}'">
                    <label for="profile_pic" class="avatar-edit-instagram">
                        <i class="fas fa-camera"></i>
                    </label>
                </div>
            </div>
            
            <!-- RIGHT COLUMN: USER DETAILS -->
            <div class="profile-details-col">
                <h2 class="profile-name-instagram">{{ session.full_name }}</h2>
                
                <div class="profile-email-instagram">
                    <i class="fas fa-envelope"></i>
                    <span class="profile-text">{{ session.email }}</span>
                </div>
                
                <div class="profile-phone-instagram">
                    <i class="fas fa-phone"></i>
                    <span class="profile-text">{{ session.phone or 'Not set' }}</span>
                </div>
                
                <!-- âœ… FIXED: Full date and time in IST format -->
                <div class="profile-member-instagram">
                    <i class="fas fa-calendar"></i>
                    <span class="profile-text">
                        Joined 
                        {% if session.get('created_at') and session.created_at != 'N/A' %}
                            {% set datetime = session.created_at %}
                            {% if 'T' in datetime %}
                                {% set date_part = datetime.split('T')[0] %}
                                {% set time_part = datetime.split('T')[1].split('.')[0] %}
                                {{ date_part }} {{ time_part }} IST
                            {% else %}
                                {{ datetime }} IST
                            {% endif %}
                        {% else %}
                            N/A
                        {% endif %}
                    </span>
                </div>
            </div>
        </div>

        <!-- EDIT PROFILE BUTTON -->
        <div class="profile-edit-section">
            <button type="button" class="profile-edit-btn-instagram" onclick="showEditForm()">
                <i class="fas fa-user-edit"></i> Edit Profile
            </button>
        </div>

        <!-- EDIT FORM (HIDDEN BY DEFAULT) -->
        <form method="POST" enctype="multipart/form-data" class="profile-edit-form-premium" id="editForm">
            <input type="file" id="profile_pic" name="profile_pic" accept="image/*" hidden>
            
            <!-- PERSONAL INFO -->
            <div class="form-section">
                <h4 class="form-section-title">
                    <i class="fas fa-user-circle"></i> Personal Information
                </h4>
                
                <div class="form-row">
                    <div class="input-group">
                        <i class="fas fa-user"></i>
                        <input type="text" name="full_name" 
                               value="{{ session.full_name }}" 
                               class="form-input"
                               placeholder="Full Name"
                               required>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="input-group">
                        <i class="fas fa-envelope"></i>
                        <input type="email" name="email" 
                               value="{{ session.email }}" 
                               class="form-input"
                               placeholder="Email Address"
                               required>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="input-group">
                        <i class="fas fa-phone"></i>
                        <input type="text" name="phone" 
                               value="{{ session.phone }}" 
                               class="form-input"
                               placeholder="Phone Number">
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="input-group location-group">
                        <i class="fas fa-map-marker-alt"></i>
                        <input type="text" name="location" 
                               value="{{ session.location }}" 
                               class="form-input location-input"
                               placeholder="Your Location">
                        <button type="button" class="location-btn" onclick="getLocation()" title="Use current location">
                            <i class="fas fa-location-crosshairs"></i>
                        </button>
                    </div>
                </div>
            </div>

            <!-- PASSWORD CHANGE -->
            <div class="form-section">
                <h4 class="form-section-title">
                    <i class="fas fa-lock"></i> Change Password
                </h4>
                
                <div class="form-row">
                    <div class="input-group">
                        <i class="fas fa-key"></i>
                        <input type="password" name="new_password" 
                               id="new_password"
                               class="form-input"
                               placeholder="New Password (optional)"
                               minlength="6">
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="input-group">
                        <i class="fas fa-key"></i>
                        <input type="password" name="confirm_password" 
                               id="confirm_password"
                               class="form-input"
                               placeholder="Confirm Password"
                               minlength="6">
                    </div>
                </div>
            </div>

            <!-- FORM ACTIONS -->
            <div class="form-actions">
                <button type="button" class="cancel-btn" onclick="hideEditForm()">
                    <i class="fas fa-times"></i> Cancel
                </button>
                <button type="submit" class="save-btn">
                    <i class="fas fa-save"></i> Save Changes
                </button>
            </div>
        </form>

        <!-- QUICK ACTIONS - 4 COLUMN GRID -->
        <div class="quick-actions-grid">
            <a href="{{ url_for('dashboard') }}" class="action-card">
                <i class="fas fa-home"></i>
                <span>Dashboard</span>
            </a>
            <a href="{{ url_for('menu') }}" class="action-card">
                <i class="fas fa-utensils"></i>
                <span>Menu</span>
            </a>
            <a href="{{ url_for('cart') }}" class="action-card">
                <i class="fas fa-shopping-cart"></i>
                <span>Cart</span>
            </a>
            <a href="{{ url_for('logout') }}" class="action-card logout-card">
                <i class="fas fa-sign-out-alt"></i>
                <span>Logout</span>
            </a>
        </div>
    </main>

    <!-- BOTTOM NAVIGATION -->
    <nav class="bottom-nav">
        <a href="{{ url_for('services') }}" class="nav-item">
            <i class="fas fa-concierge-bell"></i>
            <span>Services</span>
        </a>
        <a href="{{ url_for('menu') }}" class="nav-item">
            <i class="fas fa-utensils"></i>
            <span>Menu</span>
        </a>
        <a href="{{ url_for('cart') }}" class="nav-item">
            <i class="fas fa-shopping-cart"></i>
            <span>Cart</span>
        </a>
        <a href="{{ url_for('order_history') }}" class="nav-item">
            <i class="fas fa-history"></i>
            <span>Orders</span>
        </a>
        <a href="{{ url_for('profile') }}" class="nav-item active">
            <i class="fas fa-user"></i>
            <span>Profile</span>
        </a>
    </nav>
</div>

<style>
/* ===== PREMIUM PROFESSIONAL THEME - THINNER BORDERS ===== */
@import url('https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;500;600;700;800&family=Inter:wght@300;400;500;600;700&display=swap');

:root {
    /* CART THEME COLOURS */
    --service-card-base: #0D0D0D;
    --service-title: #A0A0A0;
    --service-icon: #8e7d4d;
    --service-border-detail: #333333;
    --golden-vivid: #D4AF37;
    --golden-metallic: #C0B283;
    --golden-glow: rgba(212, 175, 55, 0.4);
    --creamy-white: #F4F1E1;
    --silver-mist: #A0A0A0;
    --matte-black: #0D0D0D;
    --bronze-glow: 0 0 15px rgba(142, 125, 77, 0.3);
    
    /* FONTS */
    --serif-font: 'Playfair Display', Georgia, serif;
    --sans-font: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
}

/* ===== MAIN CONTAINER ===== */
.dashboard {
    background: var(--service-card-base);
    max-width: 500px;
    margin: 0 auto;
    padding-bottom: 80px;
    min-height: 100vh;
}

/* ===== HEADER - THINNER BORDER (0.2px) ===== */
.dashboard-header {
    background: var(--service-card-base);
    padding: 16px 20px;
    border-bottom: 0.2px solid var(--service-border-detail);
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.header-left h1 {
    color: var(--creamy-white);
    margin: 0 0 4px 0;
}

.welcome-text {
    color: var(--service-title);
    margin: 0;
}

.profile-pic {
    width: 40px;
    height: 40px;
    border-radius: 50%;
    object-fit: cover;
    border: 1.5px solid var(--service-icon);
    transition: all 0.3s ease;
}

.profile-pic:hover {
    border-color: var(--golden-vivid);
    box-shadow: var(--bronze-glow);
}

/* ===== INSTAGRAM 2-COLUMN PROFILE ===== */
.profile-header-instagram {
    display: flex;
    align-items: center;
    gap: 20px;
    padding: 24px 20px;
    background: var(--service-card-base);
    border-bottom: 0.2px solid var(--service-border-detail);
}

/* LEFT COLUMN - PHOTO */
.profile-photo-col {
    flex: 0 0 90px;
}

.profile-avatar-instagram {
    position: relative;
    width: 90px;
    height: 90px;
}

.profile-img-instagram {
    width: 100%;
    height: 100%;
    border-radius: 50%;
    object-fit: cover;
    border: 2px solid var(--service-icon);
    box-shadow: 0 4px 15px rgba(0,0,0,0.3);
    transition: all 0.3s ease;
}

.profile-img-instagram:hover {
    border-color: var(--golden-vivid);
    box-shadow: var(--bronze-glow);
}

/* Camera Edit Button */
.avatar-edit-instagram {
    position: absolute;
    bottom: 0;
    right: 0;
    background: var(--service-icon);
    width: 26px;
    height: 26px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    color: #000000;
    cursor: pointer;
    border: 2px solid var(--service-card-base);
    font-size: 11px;
    transition: all 0.2s ease;
}

.avatar-edit-instagram:hover {
    transform: scale(1.1);
    background: var(--golden-vivid);
    box-shadow: var(--bronze-glow);
}

/* RIGHT COLUMN - USER DETAILS */
.profile-details-col {
    flex: 1;
    display: flex;
    flex-direction: column;
    gap: 8px;
    overflow: hidden;
}

.profile-name-instagram {
    font-family: var(--serif-font);
    font-size: 20px;
    font-weight: 700;
    color: var(--creamy-white);
    margin: 0 0 2px 0;
    line-height: 1.2;
    white-space: normal;
    word-break: break-word;
}

.profile-email-instagram,
.profile-phone-instagram,
.profile-member-instagram {
    display: flex;
    align-items: center;
    gap: 8px;
    font-family: var(--sans-font);
    font-size: 13px;
    color: var(--service-title);
    width: 100%;
}

.profile-text {
    white-space: normal;
    word-break: break-word;
    line-height: 1.4;
}

.profile-email-instagram i,
.profile-phone-instagram i,
.profile-member-instagram i {
    color: var(--service-icon);
    font-size: 12px;
    width: 16px;
    text-align: center;
    flex-shrink: 0;
}

/* ===== EDIT PROFILE BUTTON ===== */
.profile-edit-section {
    padding: 16px 20px;
    background: var(--service-card-base);
    border-bottom: 0.2px solid var(--service-border-detail);
}

.profile-edit-btn-instagram {
    width: 100%;
    padding: 12px;
    background: transparent;
    border: 1px solid var(--service-border-detail);
    border-radius: 8px;
    font-family: var(--sans-font);
    font-size: 14px;
    font-weight: 600;
    color: var(--creamy-white);
    cursor: pointer;
    transition: all 0.2s ease;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
}

.profile-edit-btn-instagram i {
    color: var(--service-icon);
    font-size: 14px;
    transition: all 0.2s ease;
}

.profile-edit-btn-instagram:hover {
    background: rgba(142, 125, 77, 0.1);
    border-color: var(--service-icon);
    transform: translateY(-1px);
}

.profile-edit-btn-instagram:hover i {
    color: var(--golden-vivid);
}

/* ===== EDIT FORM ===== */
.profile-edit-form-premium {
    background: var(--service-card-base);
    padding: 20px;
    display: none;
    border-bottom: 0.2px solid var(--service-border-detail);
}

.form-section {
    margin-bottom: 24px;
    padding-bottom: 20px;
    border-bottom: 0.2px solid var(--service-border-detail);
}

.form-section:last-child {
    border-bottom: none;
    margin-bottom: 0;
    padding-bottom: 0;
}

.form-section-title {
    font-family: var(--sans-font);
    font-size: 15px;
    font-weight: 600;
    color: var(--creamy-white);
    margin: 0 0 16px 0;
    display: flex;
    align-items: center;
    gap: 8px;
}

.form-section-title i {
    color: var(--service-icon);
    font-size: 16px;
}

.form-row {
    margin-bottom: 12px;
}

.input-group {
    position: relative;
    display: flex;
    align-items: center;
}

.input-group i {
    position: absolute;
    left: 14px;
    color: var(--service-title);
    font-size: 14px;
    z-index: 2;
}

.form-input {
    width: 100%;
    padding: 12px 16px 12px 42px;
    border: 0.2px solid var(--service-border-detail);
    border-radius: 8px;
    font-family: var(--sans-font);
    font-size: 14px;
    color: var(--creamy-white);
    background: rgba(20, 20, 20, 0.8);
    outline: none;
    transition: all 0.2s ease;
    box-sizing: border-box;
    backdrop-filter: blur(5px);
}

.form-input:focus {
    border-color: var(--service-icon);
    background: rgba(30, 30, 30, 0.9);
    box-shadow: 0 0 0 2px rgba(142, 125, 77, 0.1);
}

/* Location Button */
.location-group {
    position: relative;
}

.location-input {
    padding-right: 80px !important;
}

.location-btn {
    position: absolute;
    right: 8px;
    background: transparent;
    border: 0.2px solid var(--service-border-detail);
    color: var(--service-icon);
    cursor: pointer;
    padding: 0;
    width: 32px;
    height: 32px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 14px;
    transition: all 0.2s ease;
    z-index: 3;
    border-radius: 6px;
}

.location-btn:hover {
    color: var(--golden-vivid);
    background: rgba(142, 125, 77, 0.15);
    border-color: var(--service-icon);
}

/* ===== FORM ACTION BUTTONS ===== */
.form-actions {
    display: flex;
    gap: 12px;
    margin-top: 24px;
}

.cancel-btn {
    flex: 1;
    padding: 12px;
    background: transparent;
    border: 0.2px solid var(--service-border-detail);
    border-radius: 8px;
    font-family: var(--sans-font);
    font-size: 14px;
    font-weight: 600;
    color: var(--service-title);
    cursor: pointer;
    transition: all 0.2s ease;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 6px;
}

.cancel-btn:hover {
    background: rgba(239, 68, 68, 0.1);
    border-color: #ef4444;
    color: #ef4444;
}

.save-btn {
    flex: 1;
    padding: 12px;
    background: linear-gradient(135deg, var(--golden-vivid), var(--golden-metallic));
    border: none;
    border-radius: 8px;
    font-family: var(--sans-font);
    font-size: 14px;
    font-weight: 700;
    color: #000000;
    cursor: pointer;
    transition: all 0.3s ease;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 6px;
    position: relative;
    overflow: hidden;
}

.save-btn::before {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(
        90deg, 
        transparent, 
        rgba(255, 255, 255, 0.2), 
        transparent
    );
    transition: left 0.7s ease;
    z-index: 1;
}

.save-btn:hover::before {
    left: 100%;
}

.save-btn:hover {
    transform: translateY(-2px);
    background: linear-gradient(135deg, #E4C158, #D0C08D);
    box-shadow: 0 6px 20px rgba(212, 175, 55, 0.25);
}

/* ===== QUICK ACTIONS ===== */
.quick-actions-grid {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 10px;
    padding: 20px;
    background: var(--service-card-base);
    border-bottom: 0.2px solid var(--service-border-detail);
}

.action-card {
    padding: 12px 6px;
    background: rgba(20, 20, 20, 0.8);
    border: 0.2px solid var(--service-border-detail);
    border-radius: 8px;
    font-family: var(--sans-font);
    font-size: 12px;
    color: var(--creamy-white);
    text-decoration: none;
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 6px;
    transition: all 0.2s ease;
    text-align: center;
    backdrop-filter: blur(5px);
}

.action-card i {
    font-size: 18px;
    color: var(--service-icon);
    transition: all 0.2s ease;
}

.action-card:hover {
    background: rgba(40, 40, 40, 0.9);
    transform: translateY(-2px);
    border-color: var(--service-icon);
    box-shadow: var(--bronze-glow);
}

.action-card:hover i {
    color: var(--golden-vivid);
}

.action-card.logout-card i {
    color: #ef4444;
}

.action-card.logout-card:hover {
    background: rgba(239, 68, 68, 0.1);
    border-color: #ef4444;
}

/* ===== RESPONSIVE ===== */
@media (max-width: 480px) {
    .dashboard-header {
        padding: 12px 16px;
    }
    
    .profile-pic {
        width: 36px;
        height: 36px;
    }
    
    .profile-header-instagram {
        padding: 20px 16px;
        gap: 16px;
    }
    
    .profile-photo-col {
        flex: 0 0 80px;
    }
    
    .profile-avatar-instagram {
        width: 80px;
        height: 80px;
    }
    
    .profile-name-instagram {
        font-size: 18px;
    }
    
    .profile-email-instagram,
    .profile-phone-instagram,
    .profile-member-instagram {
        font-size: 12px;
    }
    
    .quick-actions-grid {
        padding: 16px;
        gap: 8px;
    }
}

@media (max-width: 360px) {
    .profile-header-instagram {
        gap: 12px;
    }
    
    .profile-photo-col {
        flex: 0 0 70px;
    }
    
    .profile-avatar-instagram {
        width: 70px;
        height: 70px;
    }
    
    .avatar-edit-instagram {
        width: 22px;
        height: 22px;
        font-size: 10px;
    }
    
    .profile-name-instagram {
        font-size: 16px;
    }
    
    .profile-email-instagram,
    .profile-phone-instagram,
    .profile-member-instagram {
        font-size: 11px;
    }
    
    .quick-actions-grid {
        grid-template-columns: repeat(2, 1fr);
        gap: 10px;
    }
}
</style>

<script>
// Show/hide edit form
function showEditForm() {
    document.getElementById('editForm').style.display = 'block';
    window.scrollTo({ top: 0, behavior: 'smooth' });
}

function hideEditForm() {
    document.getElementById('editForm').style.display = 'none';
    window.scrollTo({ top: 0, behavior: 'smooth' });
}

// Preview image
function previewImage(event) {
    const reader = new FileReader();
    reader.onload = function() {
        document.querySelector('.profile-img-instagram').src = reader.result;
        document.querySelector('.profile-pic').src = reader.result;
    }
    reader.readAsDataURL(event.target.files[0]);
}

// Get location
function getLocation() {
    if (!navigator.geolocation) {
        alert('Geolocation not supported');
        return;
    }
    
    const locationInput = document.querySelector('input[name="location"]');
    const originalPlaceholder = locationInput.placeholder;
    locationInput.placeholder = 'Getting location...';
    
    navigator.geolocation.getCurrentPosition(
        function(position) {
            const lat = position.coords.latitude;
            const lon = position.coords.longitude;
            
            fetch(`https://nominatim.openstreetmap.org/reverse?lat=${lat}&lon=${lon}&format=json`)
                .then(response => response.json())
                .then(data => {
                    locationInput.value = data.display_name || `${lat}, ${lon}`;
                    locationInput.placeholder = originalPlaceholder;
                })
                .catch(() => {
                    locationInput.value = `${lat}, ${lon}`;
                    locationInput.placeholder = originalPlaceholder;
                });
        },
        function(error) {
            alert('Unable to get location');
            locationInput.placeholder = originalPlaceholder;
        }
    );
}

// DOM Ready
document.addEventListener('DOMContentLoaded', function() {
    const avatarEditBtn = document.querySelector('.avatar-edit-instagram');
    if (avatarEditBtn) {
        avatarEditBtn.addEventListener('click', function(e) {
            e.preventDefault();
            document.getElementById('profile_pic').click();
        });
    }
    
    const profilePicInput = document.getElementById('profile_pic');
    if (profilePicInput) {
        profilePicInput.addEventListener('change', previewImage);
    }
});
</script>
{% endblock %}
