<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Payment - Bite Me Buddy</title><script src="https://checkout.razorpay.com/v1/checkout.js"></script><style>*{margin:0;padding:0;box-sizing:border-box;font-family:'Segoe UI',sans-serif}body{background:#f5f7fa;min-height:100vh;display:flex;align-items:center;justify-content:center;padding:15px}.payment-card{background:white;border-radius:12px;box-shadow:0 6px 20px rgba(0,0,0,0.08);width:100%;max-width:380px;overflow:hidden;border:1px solid #eef2f7}.card-header{background:linear-gradient(135deg,#4f46e5,#7c3aed);color:white;padding:20px;text-align:center}.card-header h1{font-size:20px;font-weight:600;margin-bottom:4px}.card-header p{font-size:13px;opacity:0.9}.card-body{padding:20px}.order-summary{background:#f8fafc;border-radius:10px;padding:16px;margin-bottom:20px;border:1px solid #eef2f7}.summary-row{display:flex;justify-content:space-between;margin-bottom:8px;font-size:14px}.summary-row:last-child{margin-bottom:0}.summary-label{color:#64748b}.summary-value{color:#1e293b;font-weight:500}.total-amount{margin-top:12px;padding-top:12px;border-top:2px dashed #e2e8f0;display:flex;justify-content:space-between;align-items:center}.total-label{font-size:15px;color:#4f46e5;font-weight:600}.total-value{font-size:24px;color:#4f46e5;font-weight:700}.payment-action{width:100%;padding:14px;background:linear-gradient(135deg,#10b981,#059669);color:white;border:none;border-radius:10px;font-size:16px;font-weight:600;cursor:pointer;transition:all 0.2s ease;display:flex;align-items:center;justify-content:center;gap:8px;margin-bottom:16px}.payment-action:hover{background:linear-gradient(135deg,#059669,#047857);transform:translateY(-1px)}.payment-action:disabled{background:#94a3b8;cursor:not-allowed;transform:none}.loading{display:inline-block;width:16px;height:16px;border:2px solid rgba(255,255,255,.3);border-radius:50%;border-top-color:white;animation:spin 1s ease-in-out infinite}@keyframes spin{to{transform:rotate(360deg)}}.security-info{display:flex;align-items:center;justify-content:center;gap:6px;font-size:12px;color:#64748b;margin-bottom:16px}.back-link{display:block;text-align:center;color:#4f46e5;text-decoration:none;font-size:14px;font-weight:500;padding:6px;border-radius:6px;transition:background 0.2s}.back-link:hover{background:#f8f7ff}.error-message{background:#fee2e2;border:1px solid #fca5a5;color:#dc2626;padding:10px;border-radius:8px;margin-bottom:16px;font-size:13px;display:none;text-align:center}</style></head><body><div class="payment-card"><div class="card-header"><h1>Complete Payment</h1><p>Secure checkout with Razorpay</p></div><div class="card-body"><div class="order-summary"><div class="summary-row"><span class="summary-label">Order ID:</span><span class="summary-value">#{{ order_id }}</span></div><div class="summary-row"><span class="summary-label">Date:</span><span class="summary-value" id="currentDate">{{ format_ist_time(ist_now(), "%d %b %Y") }}</span></div><div class="total-amount"><span class="total-label">Total Amount</span><span class="total-value">‚Çπ{{ "%.2f"|format(amount) }}</span></div></div><div class="error-message" id="errorMessage"><span id="errorText"></span></div><button class="payment-action" id="payButton"><span>Pay ‚Çπ{{ "%.2f"|format(amount) }}</span><span class="loading" style="display:none;" id="loadingSpinner"></span></button><div class="security-info"><span>üîí</span><span>Secure & encrypted payment</span></div><a href="/order_history" class="back-link">‚Üê Back to Orders</a></div></div><script>const orderId={{ order_id }};const amount={{ amount }};const razorpayKeyId="{{ razorpay_key_id }}";let isProcessing=false;function showError(m){document.getElementById('errorMessage').style.display='block';document.getElementById('errorText').textContent=m;setTimeout(()=>{document.getElementById('errorMessage').style.display='none'},5000)}function openRazorpay(){if(isProcessing)return;isProcessing=true;const b=document.getElementById('payButton');const s=document.getElementById('loadingSpinner');b.disabled=true;s.style.display='inline-block';b.innerHTML='<span>Processing...</span>'+b.innerHTML;fetch('/create_razorpay_order',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({amount:amount,order_id:orderId})}).then(r=>r.json()).then(d=>{if(d.success){const o={"key":razorpayKeyId,"amount":d.amount,"currency":d.currency,"name":"Bite Me Buddy","description":`Order #${orderId}`,"image":"/static/logo.png","order_id":d.order_id,"handler":function(r){verifyPayment(r)},"prefill":{"name":"{{ session.get('full_name', '') }}","email":"{{ session.get('email', '') }}","contact":"{{ session.get('phone', '') }}"},"notes":{"order_id":orderId.toString(),"user_id":"{{ session.get('user_id', '') }}"},"theme":{"color":"#4f46e5"},"modal":{"ondismiss":function(){isProcessing=false;b.disabled=false;s.style.display='none';b.innerHTML=`<span>Pay ‚Çπ${amount.toFixed(2)}</span>`+'<span class="loading" style="display:none;" id="loadingSpinner"></span>'}}};new Razorpay(o).open()}else{throw new Error(d.message||'Failed')}}).catch(e=>{console.error(e);showError('Payment failed');isProcessing=false;b.disabled=false;s.style.display='none';b.innerHTML=`<span>Pay ‚Çπ${amount.toFixed(2)}</span>`+'<span class="loading" style="display:none;" id="loadingSpinner"></span>'})}function verifyPayment(r){const b=document.getElementById('payButton');b.innerHTML='<span>Verifying...</span>'+'<span class="loading" id="loadingSpinner"></span>';fetch('/verify_razorpay_payment',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({razorpay_payment_id:r.razorpay_payment_id,razorpay_order_id:r.razorpay_order_id,razorpay_signature:r.razorpay_signature,order_id:orderId})}).then(r=>r.json()).then(d=>{if(d.success){window.location.href=`/payment_success?payment_id=${r.razorpay_payment_id}&order_id=${orderId}`}else{throw new Error(d.message||'Failed')}}).catch(e=>{console.error(e);showError('Verification failed');window.location.href=`/payment_failed?order_id=${orderId}&reason=${encodeURIComponent(e.message)}`})}document.getElementById('payButton').addEventListener('click',openRazorpay);document.getElementById('currentDate').textContent=new Date().toLocaleDateString('en-IN',{day:'numeric',month:'short',year:'numeric'})</script></body></html>
