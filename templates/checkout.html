{% extends "base.html" %}

{% block title %}Checkout{% endblock %}

{% block content %}
<div class="dashboard">
    <!-- Top Header -->
    <header class="dashboard-header">
        <div class="header-left">
            <h1>Checkout</h1>
            <p class="welcome-text">Complete your order</p>
        </div>
        <div class="header-right">
            <img src="{{ session.profile_pic }}" 
                 alt="Profile" class="profile-pic"
                 onerror="this.src='{{ url_for('static', filename='default-avatar.jpg') }}'">
        </div>
    </header>

    <!-- Checkout Form - SIMPLIFIED -->
    <main class="main-content">
        <form method="POST" action="{{ url_for('checkout') }}" class="checkout-form" id="checkoutForm">
            <!-- SIMPLE FORM - NO COMPLEX JS -->
            <div class="form-section">
                <h3><i class="fas fa-map-marker-alt"></i> Delivery Information</h3>
                
                <div class="form-group">
                    <label for="delivery_location">Delivery Location *</label>
                    <textarea id="delivery_location" name="delivery_location" rows="3" required 
                              placeholder="Enter complete address with landmark, city, pin code">{{ session.location|default('') }}</textarea>
                    <small>Enter the complete delivery address</small>
                </div>
            </div>
            
            <div class="form-section">
                <h3><i class="fas fa-credit-card"></i> Payment Method</h3>
                
                <div class="payment-options">
                    <label class="payment-option">
                        <input type="radio" name="payment_mode" value="COD" required checked>
                        <div class="payment-content">
                            <i class="fas fa-money-bill-wave"></i>
                            <div>
                                <strong>Cash on Delivery</strong>
                                <small>Pay when you receive</small>
                            </div>
                        </div>
                    </label>
                    
                    <label class="payment-option">
                        <input type="radio" name="payment_mode" value="UPI">
                        <div class="payment-content">
                            <i class="fas fa-mobile-alt"></i>
                            <div>
                                <strong>UPI Payment</strong>
                                <small>Google Pay, PhonePe, etc.</small>
                            </div>
                        </div>
                    </label>
                    
                    <label class="payment-option">
                        <input type="radio" name="payment_mode" value="Card">
                        <div class="payment-content">
                            <i class="fas fa-credit-card"></i>
                            <div>
                                <strong>Card Payment</strong>
                                <small>Credit/Debit card</small>
                            </div>
                        </div>
                    </label>
                </div>
            </div>
            
            <!-- Order Summary - SIMPLIFIED -->
            <div class="form-section">
                <h3><i class="fas fa-receipt"></i> Order Summary</h3>
                <div class="order-summary">
                    <div class="summary-item total">
                        <span><strong>Total Amount</strong></span>
                        <span><strong>₹{{ "%.2f"|format(cart_total) }}</strong></span>
                    </div>
                </div>
            </div>
            
            <div class="checkout-actions">
                <a href="{{ url_for('cart') }}" class="btn btn-secondary">
                    <i class="fas fa-arrow-left"></i> Back to Cart
                </a>
                <button type="submit" class="btn btn-primary" id="confirmOrderBtn">
                    <i class="fas fa-check"></i> Confirm Order (₹{{ "%.2f"|format(cart_total) }})
                </button>
            </div>
        </form>
    </main>

    <!-- Bottom Navigation -->
    <nav class="bottom-nav">
        <a href="{{ url_for('services') }}" class="nav-item">
            <i class="fas fa-concierge-bell"></i>
            <span>Services</span>
        </a>
        <a href="{{ url_for('menu') }}" class="nav-item">
            <i class="fas fa-utensils"></i>
            <span>Menu</span>
        </a>
        <a href="{{ url_for('cart') }}" class="nav-item">
            <i class="fas fa-shopping-cart"></i>
            <span>Cart</span>
        </a>
        <a href="{{ url_for('order_history') }}" class="nav-item">
            <i class="fas fa-history"></i>
            <span>Orders</span>
        </a>
        <a href="{{ url_for('profile') }}" class="nav-item">
            <i class="fas fa-user"></i>
            <span>Profile</span>
        </a>
    </nav>
</div>

<!-- SIMPLE VALIDATION SCRIPT -->
<script>
document.addEventListener('DOMContentLoaded', function() {
    const form = document.getElementById('checkoutForm');
    
    // Basic form validation
    form.addEventListener('submit', function(e) {
        const location = document.getElementById('delivery_location').value.trim();
        const paymentMode = document.querySelector('input[name="payment_mode"]:checked');
        
        if (!location) {
            alert('Please enter delivery location');
            e.preventDefault();
            return;
        }
        
        if (!paymentMode) {
            alert('Please select payment method');
            e.preventDefault();
            return;
        }
        
        // Disable button to prevent double click
        const submitBtn = document.getElementById('confirmOrderBtn');
        submitBtn.disabled = true;
        submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Processing...';
    });
    
    // Auto-populate delivery location if empty
    const deliveryField = document.getElementById('delivery_location');
    if (deliveryField && !deliveryField.value.trim()) {
        const userLocation = "{{ session.location|default('') }}";
        if (userLocation) {
            deliveryField.value = userLocation;
        }
    }
});

// Simple location function (optional)
function useCurrentLocation() {
    if (!navigator.geolocation) {
        alert('Geolocation not supported by your browser');
        return;
    }
    
    const locationField = document.getElementById('delivery_location');
    locationField.placeholder = 'Getting location...';
    
    navigator.geolocation.getCurrentPosition(
        function(position) {
            const lat = position.coords.latitude;
            const lon = position.coords.longitude;
            locationField.value = `${lat}, ${lon}`;
            locationField.placeholder = '';
        },
        function() {
            alert('Unable to get location. Please enter manually.');
            locationField.placeholder = 'Enter delivery address';
        }
    );
}
</script>

<style>
.order-summary {
    background: #f8f9fa;
    border-radius: 8px;
    padding: 15px;
    margin-top: 10px;
}

.summary-item {
    display: flex;
    justify-content: space-between;
    padding: 8px 0;
    border-bottom: 1px dashed #dee2e6;
}

.summary-item:last-child {
    border-bottom: none;
}

.summary-item.total {
    font-size: 1.1em;
    border-top: 2px solid #dee2e6;
    margin-top: 10px;
    padding-top: 15px;
}
</style>
{% endblock %}